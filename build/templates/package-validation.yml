parameters:
- name: templateArgs
  type: string
  default: ''

- name: projectName
  type: string
  default: ''

steps:

- powershell: |
      Set-PSDebug -Trace 1
      $ErrorActionPreference = 'Stop'

      # Create app with defaults
      dotnet new unoapp -skip -o ${{ parameters.projectName }} ${{ parameters.templateArgs }}
      if ($LASTEXITCODE -ne 0)
      {
          throw "Exit code must be zero."
      }

  displayName: Create template app ${{ parameters.projectName }}

- template: canary-updater.yml
  parameters:
    MergeBranch: false

- powershell: |
      Set-PSDebug -Trace 1
      $ErrorActionPreference = 'Stop'

      cd ${{ parameters.projectName }}

      & dotnet build ${{ parameters.projectName }}.sln "/bl:$(build.artifactstagingdirectory)\${{ parameters.projectName }}.binlog"
      if ($LASTEXITCODE -ne 0)
      {
          throw "Exit code must be zero."
      }

  displayName: Build template app ${{ parameters.projectName }}
